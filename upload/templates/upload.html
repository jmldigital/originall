
<head>
<link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.css" />
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.js"></script>

</head>


<script>

$(document).ready(function() {
    $('#example').DataTable();

     $('.dataTables_filter input[type="search"]')
        .attr('placeholder','  Поиск...');
    
});

    $(document).ready(function() {
        $('#example2').DataTable();
          });

    $(document).ready(function() {
        $('#example4').DataTable();
          });


    </script>

{% block content %}
{% load tailwind_filters %}

<body>


<div class="container px-5 py-24 mx-auto flex flex-wrap">
  <div class="w-full flex justify-between">


       <!---- стоп слова -->
        <div class="lg:w-1/4 mb-6 py-6  justify-between items-left  border-gray-200">
          <table id="example" class="table table-striped display nowrap " style="width:100%;">
              <thead>
                  <tr>
                      <th>стоп слова</th>
                      <th></th>
                  </tr>
              </thead>
              <tbody>
                  {% for word in words %}
                  <tr class="post-{{word.id}}">
                      <td class="text-center"> {{ word.words }} </td>
                      <td class="text-center">
                        {% csrf_token %}
                          <button type="button"  class="delete_button" data-id="{{ word.pk }}" > Удалить </button>
                      </td>
                  </tr>
              {% endfor %}

              </tbody>
              <tfoot>
                  <tr>
                      <th>Всего {{ len }}</th><th> </th>
                  </tr>       
              </tfoot>
          </table>
                <form id='stopwords-form'>
                  {%csrf_token%}
                  
                  {{ form_words|crispy }}
                
                  <button type="Submit" class=" bg-blue-500 hover:bg-blue-600 px-3 py-3 mt-7 text-white rounded-md color-white" name="btnform1"> Добавить стоп слово</button>
                </form>
      </div>
      <!---- конец стоп слов -->

             <!---- бренды -->
             <div class="lg:w-1/3 mb-6 py-6  justify-between items-left  border-gray-200">
              <table id="example2" class="table table-striped display nowrap " style="width:50%;">
                  <thead>
                      <tr>
                          <th>бренды</th>
                          <th></th>
                      </tr>
                  </thead>
                  <tbody>
                      {% for brand in brands %}
                      <tr class="post-{{brand.pk}}">
                          <td class="text-center"> {{ brand.brand }} </td>
                          <td class="text-center">
                            {% csrf_token %}
                            <button type="button"  class="delete_buttonbr" data-id="{{ brand.pk }}" > Удалить </button>
                          </td>
                      </tr>
                  {% endfor %}
    
                  </tbody>
                  <tfoot>
                      <tr>
                          <th>Всего {{ len }}</th><th> </th>
                      </tr>       
                  </tfoot>
              </table>
                    <form id="brand-form" >
                      {%csrf_token%}
                      
                      {{ form_brands.brand|as_crispy_field }}
                    
                      <button type="Submit" class=" bg-blue-500 hover:bg-blue-600 px-3 py-3 mt-7 text-white rounded-md color-white" name="btnform3"> Добавить бренд</button>
                    </form>
          </div>
          <!---- конец брендов -->


    </div>





       <!---- прайсы------------------------ -->

  <div class="w-full mb-6 py-6  justify-between items-left  border-gray-200">
    <table id="example4" class="table table-striped display nowrap " style="width:100%;">
        <thead>
            <tr>
                <th>файлы</th>
                <th>номер</th>
                <th>бренд</th>
                <th>название</th>
                <th>вес</th>
                <th>объем</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for file in files %}
            <tr class="post-{{file.pk}}">
                <td class="text-center"> {{ file.files }} </td>
                <td class="text-center"> {{ file.oem_field }} </td>
                <td class="text-center"> {{ file.brend_field }} </td>                
                <td class="text-center"> {{ file.name_field }} </td>
                <td class="text-center"> {{ file.weight_field }} </td>
                <td class="text-center"> {{ file.volume_field }} </td>
                <td class="text-center">
                    {% csrf_token %}
                    <button type="button"  class="delete_price" data-id="{{ file.pk }}" > Удалить </button>
                </td>
            </tr>
        {% endfor %}

        </tbody>
        <tfoot>
            <tr>
                <th>Всего {{ len }}</th> 
                <th></th>  
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>        
        </tfoot>
    </table>
</div>

<form id="price-forms" enctype="multipart/form-data" >
    {%csrf_token%}
    
  {{ form_files.brend_field|as_crispy_field }}
  {{ form_files.files|as_crispy_field }}
  <button type="Submit" class=" bg-blue-500 hover:bg-blue-600 px-3 py-3 mt-7 text-white rounded-md color-white" name="btnform2"> Добавить прайс</button>
</form>

       <!---- ------- конец прайсов------------------------ -->

<div style="display:block;">
<a href="{% url 'bd-create' %}" class="text-indigo-600 hover:text-indigo-900 pb-5"> Создать Базу </a>

<strong>тут:  {{ test }} </strong>
</div>
<div class="basic">
   
</div>
</div> </div> 

{% endblock content%}

{% block javascript %}
<script>
    $("#stopwords-form").submit(function (e) {
        // preventing default actions
        e.preventDefault();
        // serialize the data for sending the form data.
        var serializedData = $(this).serialize();
        // Ajax Call
        $.ajax({
            type: 'POST',
            url: "{% url 'upload' %}",
            data: serializedData,
			// handle a successful response
            success: function (response) {
                // On successful, clear all form data
                $("#stopwords-form").trigger('reset');

                // Display new participant to table
                var instance = JSON.parse(response["instance"]);
                var fields = instance[0]["fields"];
                var pk = instance[0]["pk"];
                $("#example tbody").prepend(
                   `<tr class="post-${pk}">
                    <td class="text-center sorting_1">${fields["words"]||""}</td>
                    <td class="text-center sorting_1">
                        {% csrf_token %}
                          <button type="button"  class="delete_button" data-id='${pk}' > Удалить  </button>
                        </td>
                    </tr>`
                )
            },     
         
            error: function (response) {
                // alert non successful response
                alert(response["responseJSON"]["error"]);
            }
        });
    });

    $("body").on("click",".delete_button",function(u){
            u.preventDefault();
            var id = $(this).data('id');
            $.ajax({
                url: "delete/"+id,
                type: 'DELETE',
                dataType: 'json',
                headers: {
                    "X-CSRFTOKEN": "{{ csrf_token }}"
                },
                data: { id : id },
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}' );
                },
                success: function(response){
                    $("#example .post-" + id).remove();
                }
            });
        });


    $("#brand-form").submit(function (z) {
        // preventing default actions
        z.preventDefault();
        // serialize the data for sending the form data.
        var serializedData = $(this).serialize();
        // Ajax Call
        $.ajax({
            type: 'POST',
            url: "{% url 'upload' %}",
            data: serializedData,
			// handle a successful response
            success: function (response) {
                // On successful, clear all form data
                $("#brand-form").trigger('reset');

                // Display new participant to table
                var instance = JSON.parse(response["instance"]);
                var fields = instance[0]["fields"];
                var pk = instance[0]["pk"];
                $("#example2 tbody").prepend(
                   `<tr class="post-${pk}">
                    <td class="text-center sorting_1">${fields["brand"]||""}</td>
                    <td class="text-center sorting_1">
                        {% csrf_token %}
                            <button type="button"  class="delete_buttonbr" data-id="${pk}" > Удалить </button>
                        </td>
                    </tr>`
                );
            },     
         
            error: function (response) {
                // alert non successful response
                alert(response["responseJSON"]["error"]);
            }
        });
    });

    $("#price-forms").submit(function (a) {
        // preventing default actions
        a.preventDefault();
        $form = $(this);
        var formData = new FormData(this);
        // serialize the data for sending the form data.
        var serializedData = $(this).serialize();
        // console.log(serializedData);
        // Ajax Call
        $.ajax({
            type: 'POST',
            url: "{% url 'upload' %}",
            data: formData,
            success: function (response) {
                $("#price-forms").trigger('reset');
                var instance = JSON.parse(response["instance"]);
                var data = (response["data"]);
                // console.log(data)
                var fields = instance[0]["fields"];
                var pk = instance[0]["pk"];
                $("#example4 tbody").prepend(
                   `<tr class="post-${data["pk"]}">
                    <td class="text-center sorting_1">${fields["files"]||""}</td>
                    <td class="text-center sorting_1">${data["oem_field"]||""}</td>
                    <td class="text-center sorting_1">${data["brend_field"]||""}</td>
                    <td class="text-center sorting_1">${data["name_field"]||""}</td>
                    <td class="text-center sorting_1">${data["volume_field"]||""}</td>
                    <td class="text-center sorting_1">${data["weight_field"]||""}</td>
                    <td class="text-center sorting_1">
                        {% csrf_token %}
                            <button type="button"  class="delete_price" data-id="${data["pk"]}" > Удалить </button>
                        </td>
                    </tr>`
                );
                
             },
             error: function (response) {
                console.log(response,'произошла ошибка')
             },
            cache: false,
            contentType: false,
            processData: false
        });
    });
   
    $("body").on("click",".delete_buttonbr",function(u){
            u.preventDefault();
            var id = $(this).data('id');
            $.ajax({
                url: "delbr/"+id,
                type: 'DELETE',
                dataType: 'json',
                headers: {
                    "X-CSRFTOKEN": "{{ csrf_token }}"
                },
                data: { id : id },
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}' );
                },
                success: function(response){
                    $("#example2 .post-" + id).remove();
                }
            });
        });


        $("body").on("click",".delete_price",function(u){
            u.preventDefault();
            var id = $(this).data('id');
            $.ajax({
                url: "delpr/"+id,
                type: 'DELETE',
                dataType: 'json',
                headers: {
                    "X-CSRFTOKEN": "{{ csrf_token }}"
                },
                data: { id : id },
                beforeSend: function(xhr) {
                    xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}' );
                },
                success: function(response){
                    $("#example4 .post-" + id).remove();
                }
            });
        });

    </script>

{% endblock javascript %}   




</body>